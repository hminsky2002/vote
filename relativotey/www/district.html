<!doctype html>
<html>
    <head>
	<!-- jQuery -->
	<script   src="https://code.jquery.com/jquery-1.12.2.min.js" integrity="sha256-lZFHibXzMHo3GGeehn1hudTAP3Sc0uKXBXAzHX1sjtk=" crossorigin="anonymous"></script>


    <!-- Mabpox GL -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.17.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.17.0/mapbox-gl.css' rel='stylesheet'>

    <!-- Mapbox.js (fallback) -->
    <script src='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.css' rel='stylesheet' />

    <!-- GeoViewport -->
    <script src='geoviewport.js'></script>
    <style>

     body { margin:0; padding:0; }
     #map { position:absolute; top:0; bottom:0; width:100%; }

     /* INTERACTIVE MENU */
     #menu {
         position:absolute;
         top:10px;
         left:10px;
         background-color: white;
         margin-right: 10px;
         padding: 8px;
         border-radius: 4px;
         border: rgb(221, 221, 221);
         box-shadow: 0px 0px 0px 2px rgb(221, 221, 221);
         color: #222;
         font-family: 'Open Sans', Arial, sans-serif;
     }
     .selector { display: inline-block; float: left; margin: 4px; }

    </style>

    <!-- Load in some useful data about the states -->
    <script src='./states.js'></script>
    <script src='./bboxes.js'></script>
    <script src='./district-map.js'></script>

    <script>
     var results;


     /**
      * Build and execute request to look up voter info for provided address.
      * @param {string} address Address for which to fetch voter info.
      * @param {function(Object)} callback Function which takes the
      *     response object as a parameter.
      */
     function lookup(address, callback) {
	 /**
          * Election ID for which to fetch voter info.
          * @type {number}
          */
         var electionId = 2000;
	 
         /**
          * Request object for given parameters.
          * @type {gapi.client.HttpRequest}
          */
         var req = gapi.client.request({


             'path' : '/civicinfo/v2/representatives',
             'params' : {'address': address}
         });
	 req.execute(callback);
     }

     /**
      * Render results in the DOM.
      * @param {Object} response Response object returned by the API.
      * @param {Object} rawResponse Raw response from the API.
      */
     function renderResults(response, rawResponse) {
         var el = document.getElementById('results');
         if (!response || response.error) {
             el.appendChild(document.createTextNode(
		 'Error while trying to fetch polling place'));
             return;
         }
	 console.log(response);
	 console.log(rawResponse);
	 
	 results = response;
	 var district = null;
	 for (var key in response.divisions) {
	     var data = response[key];
	     m = key.match(/\/cd:(\d+)$/);
	     if (m != null) {
		 district = m[1];
		 break;
	     }
	 }

	 el.innerHTML = district;
     }
     


     /**
      * Initialize the API client and make a request.
      */
     function load() {
         gapi.client.setApiKey('AIzaSyCzPmoqSuBu_wgzwuRauq0V0LQYtY919Ik');
         lookup('67 Clyde st, Newton MA', renderResults);
     }
    </script>
    <script src="https://apis.google.com/js/client.js?onload=load"></script>
  </head>
  <body>
      <div id="results"></div>

      <!-- INTERACTIVE STATES AND DISTRICTS MENU -->
      <div id='menu'>
	  <div class="selector">
	      State:
	      <select id='state'>
		  <option value=""></option>
	      </select>
	  </div>
	  <div class="selector">
	      District:
	      <select id='district'>
		  <option value=''></option>
	      </select>
	  </div>
      </div>

    <div id='map'></div>

  </body>
</html>


  
